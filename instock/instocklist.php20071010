<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../include/instock_style.css" type="text/css">
<title>入貨單</title>
<style type="text/css">
<!--
body {
	margin-left: 0px;
	margin-top: 0px;
	margin-right: 0px;
	margin-bottom: 0px;
	background-color: #CCCCCC;
}

-->
</style>
<style type="text/css">
@import url(../include/cal/calendar-win2k-1.css);
</style>
<script type="text/javascript" src="../include/cal/calendar.js"></script>
<script type="text/javascript" src="../include/cal/lang/calendar-en.js"></script>
<script type="text/javascript" src="../include/cal/calendar-setup.js"></script></head>
<?php
  include_once("../include/config.php");
      require "../include/Pager.class.php";
   $query="SET NAMES 'UTF8'";
    $db = DB::connect($dsn);

   if (DB::isError($connection))
      die($connection->getMessage());
 $result = $db->query("SET NAMES 'UTF8'");
 
 $sql_Search_Supplier="select * from supplier ";
 $SupplierResult = $db->query($sql_Search_Supplier);
 
   // (Run the query on the winestore through the connection 
   ?>
<body>
<form id="form1" name="form1" method="post" action="instocklist.php">
    <div><label>供應商發票編號：</label>
  <input name="supplier_invoice_no" type="text" id="supplier_invoice_no" size="20" maxlength="20" class="buttonstyle"/>
</div>
   <div><label>入貨單編號：</label>
  <input type="text" name="instock_no" class="buttonstyle" />
</div>
   <div><label>貨品編號：</label>
  <input name="goods_partno" class="buttonstyle"type="text" id="goods_partno" />
  </div
  ><div><label>入貨單日期：</label>
<input name="instock_date_start" id="instock_date_start" class="buttonstyle" type="text"  size="15"><input name="cal" id="calendar" value=".." type="button">
至
<input name="instock_date_end" id="instock_date_end" class="buttonstyle" type="text"  size="15" />
  <input name="cal2" id="calendar2" value=".." type="button" />
  </div><div><label>供應商：</label>
  <select name="suppliername" id="suppliername">
  <option value=""> </option>
  <? while($Supplierrow = $SupplierResult->fetchRow(DB_FETCHMODE_ASSOC)){
  ?><option value="<?=$Supplierrow["supplier_id"]?>"><?=$Supplierrow["supplier_name"]?></option><?}?>
  </select>
  </div>
  <input type="submit" value="搜尋"/>
 <input type="hidden" name="update" value="2"/>
</form>
<?php

 $checking=0;
     	 if ($suppliername=="" && $supplier_invoice_no!="" && $instock_no=="" && $goods_partno=="" && $instock_date_start=="" && $instock_date_end=="")
	 	$sql="SELECT * FROM instock where supplier_invoice_no like \"%".$supplier_invoice_no."%\"";
	 else if ($suppliername=="" && $instock_no!="" && $invoice_no=="" && $goods_partno=="" && $instock_date_start=="" && $instock_date_end=="")
	 	$sql="SELECT * FROM instock where instock_no=".$instock_no;
	 else if ($suppliername=="" && $goods_partno!="" && $instock_no=="" && $supplier_invoice_no=="" && $instock_date_start=="" && $instock_date_end=="" )
	 	$sql="select instock.instock_date as instock_date, instock.instock_no as instock_no, instock.supplier_name as supplier_name,instock.supplier_invoice_no as supplier_invoice_no,instock.staff_name as staff_name,instock.count_price as count_price,instock.discount_percent as discount_percent,instock.total_price as total_price ,goods_instock.market_price as market_price from goods_instock ,instock where goods_instock.instock_no = instock.instock_no and goods_partno like \"%".$goods_partno."%\" group by instock.instock_no";
	 else if ($suppliername=="" && $instock_date_start!="" && $instock_date_end!="" && $goods_partno=="" && $instock_no=="" && $supplier_invoice_no=="")
	 	$sql="SELECT * from instock where instock.instock_date >= '".$instock_date_start." 00:00:00' and instock.instock_date <='".$instock_date_end." 23:59:00'";
		 else if ($suppliername!="" && $instock_date_start=="" && $instock_date_end=="" && $goods_partno=="" && $instock_no=="" && $supplier_invoice_no=="")
		 {
		 $sql=" select * from supplier where supplier.supplier_id='".$suppliername."'";
		
		  $SupplierResult = $db->query($sql);
		  $supplierrow = $SupplierResult->fetchRow(DB_FETCHMODE_ASSOC);
		 $sql="SELECT i.instock_date as instock_date,i.supplier_name as supplier_name, i.supplier_invoice_no as supplier_invoice_no,i.staff_name as staff_name, i.count_price as count_price, i.discount_percent as discount_percent,i.total_price as total_price,  i.instock_no as instock_no from instock i where i.supplier_name like \"%".$supplierrow['supplier_name']."%\"";
		 }
		 else if ($suppliername=="" && $instock_date_start=="" && $instock_date_end=="" && $goods_partno=="" && $instock_no=="" && $supplier_invoice_no=="")
		$sql="SELECT * FROM instock order by instock_no desc";
	 else {
	 	if ($goods_partno!=""){
	 		$sql="select i.instock_date as instock_date,i.instock_no as instock_no, i.supplier_name as supplier_name,i.supplier_invoice_no as supplier_invoice_no,i.staff_name as staff_name,i.count_price as count_price,i.discount_percent as discount_percent,i.total_price as total_price ,gi.market_price as market_price from goods_instock  as gi,instock as i  where gi.instock_no = i.instock_no and gi.goods_partno like \"%".$goods_partno."%\" ";
			$checking=1;
	 	}else{
	 		$sql="select * from instock as i  where ";
			$checking=0;
		}
		if ($supplier_invoice_no!=""){
			if ($checking==1) $sql.=" and ";
			$sql.=" i.supplier_invoice_no='".$supplier_invoice_no."' ";
		}
		if ($instock_no!=""){
			if($checking==1) $sql.=" and ";
			$sql.=" i.instock_no='".$instock_no."' ";
		}
		if ($instock_date_start!="" && $instock_date_end!=""){
			if($checking==1) $sql.=" and ";
			$sql.=" i.instock_date >= '".$instock_date_start." 00:00:00' and i.instock_date <='".$instock_date_end." 23:59:00' ";
		}
		if ($$suppliername!=""){
		    if($checking==1) $sql.=" and ";
			$sql.=" i.supplier_name='".$suppliername."' ";
		}
	}

   include('Pager_header.php');
   ?>

<?

echo $turnover;
echo $Pager->numPages;
?>
<table width="100%" border="0" cellpadding="1" cellspacing="1" bgcolor="#000000">
  <tr bgcolor="#006666">
    <td width="22" height="23" bgcolor="#006666"><div align="center"><strong>入貨單編號</strong></div></td>
    <td width="66" bgcolor="#006666"><div align="center"><strong>入貨單日期</strong></div></td>
	<td width="66" bgcolor="#006666"><div align="center"><strong>供應商名稱</strong></div></td>
    <td width="33" bgcolor="#006666"><div align="center"><strong>供應商發票編號</strong></div></td>
    <td width="22" bgcolor="#006666"><div align="center"><strong>職員</strong></div></td>
    <td width="15%" bgcolor="#006666"><div align="center"><strong>總數 </strong></div></td>
    <td width="15%" bgcolor="#006666"><div align="center"><strong>折扣</strong></div></td>
    <td width="15%" bgcolor="#006666"><div align="center"><strong>應付金額</strong></div></td>
	<?if ($goods_partno!=""){?>
	<td width="15%" bgcolor="#006666"><div align="center"><strong>單件入貨價</strong></div></td>
	<?}?>
    <td width="5%" bgcolor="#006666"><div align="center"><strong>修改</strong></div></td>
  </tr>
  <?php 
	for ($i=0;$i<count($result);$i++)
	{ 
	$row=$result[$i];
	
   ?><tr valign="middle" align="center" onMouseOver="this.className='highlight'" onMouseOut="this.className='normal'"><td class="style7">    <?=$row['instock_no']?>
  </td>
  <td class="style7">    <?=$row['instock_date']?>  </td>
  <td class="style7">    <?=$row['supplier_name']?>  </td>
  <td class="style7">    <?=$row['supplier_invoice_no']?>  </td>
  <td class="style7">    <?=$row['staff_name']?>  </td>
  <td class="style7">    <?=$row['count_price']?>  </td>
  <td class="style7">    <?=$row['discount_percent']?>  </td>
  <td class="style7">    <?=$row['total_price']?>  </td>
  	<?if ($goods_partno!=""){?>
	<td><div align="center"><strong><?=$row['market_price']?></strong></div></td>
	<?}?>
  <td><a href="instockedit.php?instock_no=<?=$row['instock_no']?>&update=2" class="b">修改</a></td>
  </tr>
<?
		 }
   ?>
</table>
<?php echo $turnover;?>
<script type="text/javascript">
  Calendar.setup(
    {
      inputField  : "instock_date_start",         // ID of the input field
      ifFormat    : "%Y-%m-%d",    // the date format
      showsTime      :    true,
      button      : "calendar"       // ID of the button
      
    }
  );
  Calendar.setup(
    {
      inputField  : "instock_date_end",         // ID of the input field
      ifFormat    : "%Y-%m-%d",    // the date format
      showsTime      :    true,
      button      : "calendar2"       // ID of the button
      
    }
  );
</script>
</body>
</html>
